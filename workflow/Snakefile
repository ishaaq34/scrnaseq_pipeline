"""
scRNA-seq Analysis Pipeline - Main Snakefile

A single-cell RNA-seq analysis pipeline using Seurat (R).

Author: Author
Date: 2026-01-14
"""

import pandas as pd
from pathlib import Path

# Configuration
configfile: "config/config.yaml"

# Load sample metadata
samples_df = pd.read_csv(config["samples"], sep="\t")
SAMPLES = samples_df["sample_id"].tolist()

# Include Rules
include: "rules/qc.smk"
include: "rules/normalization.smk"
include: "rules/clustering.smk"
include: "rules/annotation.smk"
include: "rules/differential.smk"
include: "rules/visualization.smk"

# Target Rules
rule all:
    """
    Complete scRNA-seq analysis pipeline
    """
    input:
        # QC outputs
        "results/qc/qc_metrics.csv",
        "results/qc/qc_plots.pdf",
        
        # Processed data
        "results/processed/seurat_object.rds",
        
        # Clustering
        "results/clustering/umap_clusters.pdf",
        "results/clustering/cluster_markers.csv",
        
        # Cell type annotation
        "results/annotation/cell_types.csv",
        "results/annotation/annotation_umap.pdf"


rule clean:
    """
    Remove all generated files
    """
    shell:
        """
        rm -rf results/
        rm -rf .snakemake/
        echo "Cleaned all results"
        """
